name: Get Stockfish with MultiPV Config

on:
  workflow_dispatch:

jobs:
  download-and-configure:
    runs-on: windows-latest
    
    steps:
    - name: Download Stockfish 16.1
      run: |
        # Скачиваем готовый Stockfish с официального релиза
        curl -LO "https://github.com/official-stockfish/Stockfish/releases/download/sf_16.1/stockfish-windows-x86-64-avx2.zip"
        7z x stockfish-windows-x86-64-avx2.zip -oStockfish
        
    - name: Prepare tactical configuration
      run: |
        # Создаем файл с командами для MultiPV=500
        echo "uci" > stockfish_tactical.uci
        echo "setoption name MultiPV value 500" >> stockfish_tactical.uci
        echo "setoption name UCI_Chess960 value true" >> stockfish_tactical.uci
        echo "setoption name Contempt value 24" >> stockfish_tactical.uci
        echo "setoption name Aggressiveness value 150" >> stockfish_tactical.uci
        echo "setoption name Move Overhead value 3000" >> stockfish_tactical.uci
        echo "setoption name Slow Mover value 80" >> stockfish_tactical.uci
        echo "isready" >> stockfish_tactical.uci
        echo "" >> stockfish_tactical.uci
        echo "# Пример использования:" >> stockfish_tactical.uci
        echo "# stockfish.exe < stockfish_tactical.uci" >> stockfish_tactical.uci
        echo "# position startpos" >> stockfish_tactical.uci
        echo "# go depth 15" >> stockfish_tactical.uci
        
    - name: Create batch file for easy start
      run: |
        # Создаем .bat файл для запуска с настройками
        echo @echo off > start_tactical.bat
        echo echo Запуск Stockfish с MultiPV=500 и Chess960 >> start_tactical.bat
        echo echo. >> start_tactical.bat
        echo stockfish-windows-x86-64-avx2.exe ^< stockfish_tactical.uci >> start_tactical.bat
        echo pause >> start_tactical.bat
        
    - name: Upload Stockfish executable
      uses: actions/upload-artifact@v4
      with:
        name: stockfish-windows
        path: Stockfish/stockfish-windows-x86-64-avx2.exe
        
    - name: Upload configuration files
      uses: actions/upload-artifact@v4
      with:
        name: stockfish-configs
        path: |
          stockfish_tactical.uci
          start_tactical.bat
