name: Cross-compile for Windows from Linux

on: workflow_dispatch

jobs:
  cross-compile:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup cross-compilation environment
      run: |
        # Устанавливаем mingw для кросс-компиляции
        sudo apt-get update
        sudo apt-get install -y g++-mingw-w64-x86-64
        
    - name: Clone Stockfish
      run: |
        git clone --depth 1 https://github.com/official-stockfish/Stockfish.git
        cd Stockfish/src
        
    - name: Apply tactical patches
      run: |
        cd Stockfish/src
        # Здесь ваши модификации для тактических параметров
        echo "// Тактические параметры" >> patch.h
        
    - name: Cross-compile for Windows
      run: |
        cd Stockfish/src
        # Компилируем для Windows из Linux!
        make build ARCH=x86-64-avx2 COMP=mingw CXX=x86_64-w64-mingw32-g++ -j4
        
    - name: Verify Windows executable
      run: |
        cd Stockfish/src
        file stockfish.exe || true
        echo "Размер файла:" $(ls -lh stockfish.exe)
        
    - name: Upload Windows executable
      uses: actions/upload-artifact@v4
      with:
        name: stockfish-windows-cross
        path: Stockfish/src/stockfish.exe
